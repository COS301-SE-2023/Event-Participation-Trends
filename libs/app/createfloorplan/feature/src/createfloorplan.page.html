<!-- <subpagenav [currentPage]="'/home/createfloorplan'"></subpagenav> -->

<ion-content [fullscreen]="true">
  <div class="grid grid-cols-12 gap-3 p-3 h-full">
    <div
      class="tool-menu col-span-2 rounded-lg md:rounded-xl shadow-[0px_5px_15px_2px_rgba(0,0,0,0.2)] text-ept-deep-grey relative"
      ngClass="card-container"
    >
      <div ngClass="card" [class.flipped]="isCardFlipped && isSensor()">
        <div ngClass="front-side">
          <div class="flex flex-row justify-evenly">
            <h1 class="text-lg font-semibold text-center mt-5">Tools</h1>
            <ion-button
              id="hover-trigger"
              *ngIf="isSensor()"
              class="mt-4 rounded-lg overflow-hidden self-center bg-ept-deep-grey hover:scale-105 duration-300 transition-all"
              title="Click to view linked sensors"
              (click)="toggleCardFlip()"
            >
              <ion-icon name="repeat" class="w-8 h-8"></ion-icon>
            </ion-button>
          </div>
          <h3
            class="components-heading flex justify-between items-center mt-6 ml-2"
          >
            Components
          </h3>
          <div class="components-list mb-1 overflow-hidden">
            <div class="overflow-y-auto max-h-52 flex">
              <img
                id="sensorImage"
                class="border-2 rounded-lg p-1 w-10 h-10 mt-2 cursor-grab"
                draggable="true"
                (dragstart)="onDragStart($event)"
                src="assets/sensor.png"
                alt="sensor"
              />
              <ion-text class="text-ept-deep-grey opacity-40 mt-4 ml-4"
                >Sensor</ion-text
              >
            </div>
            <div class="overflow-y-auto max-h-52 flex">
              <img
                class="border-2 rounded-lg p-1 w-10 h-10 mt-2 cursor-grab"
                #stall
                draggable="true"
                (dragstart)="onDragStart($event)"
                src="assets/stall-icon.png"
                alt="stall"
              />
              <ion-text class="text-ept-deep-grey opacity-40 mt-4 ml-4"
                >Stall</ion-text
              >
            </div>
          </div>
          <h3 class="attributes-heading mt-3 ml-2">Component Attributes</h3>
          <div
            *ngIf="!shouldStackVertically"
            id="attributes-container"
            class="flex flex-col"
          >
            <ion-item class="attributes-list flex mt-2" lines="none">
              <ion-label class="ion-col-4 mr-3 min-w-fit">Width:</ion-label>
              <ion-input
                aria-label=""
                class="ion-col-8 input-field ml-auto input focus:outline-none focus:ring-2 focus:ring-blue-500 mr-10 border-2 rounded h-7"
                type="number"
                step="1"
                [value]="activeItem ? getActiveItemWidth() : 0"
                (input)="updateWidth($event)"
                min="0"
                [disabled]="!preventCreatingWalls || activeItem == null"
              ></ion-input>
            </ion-item>
            <ion-item class="attributes-list flex mt-2" lines="none">
              <ion-label class="ion-col-4 mr-2 min-w-fit">Height:</ion-label>
              <ion-input
                aria-label=""
                class="ion-col-8 input-field input focus:outline-none focus:ring-2 focus:ring-blue-500 mr-10 border-2 rounded h-7"
                type="number"
                step="1"
                [value]="activeItem ? getActiveItemHeight() : 0"
                (input)="updateHeight($event)"
                min="0"
                [disabled]="!preventCreatingWalls || activeItem == null"
              ></ion-input>
            </ion-item>
            <ion-item class="attributes-list flex mt-2" lines="none">
              <ion-label class="ion-col-4 mr-3 min-w-fit">Angle:</ion-label>
              <ion-input
                aria-label=""
                class="ion-col-8 input-field input focus:outline-none focus:ring-2 focus:ring-blue-500 mr-10 border-2 rounded h-7"
                type="number"
                step="1"
                [value]="activeItem ? getActiveItemRotation() : 0"
                (input)="updateRotation($event)"
                min="0"
                [disabled]="!preventCreatingWalls || activeItem == null"
              ></ion-input>
            </ion-item>
          </div>
          <div
            *ngIf="shouldStackVertically"
            id="attributes-container"
            class="flex flex-col items-center justify-evenly"
          >
            <div>
              <ion-label>Width:</ion-label>
              <ion-input
                aria-label=""
                class="input-field input focus:outline-none focus:ring-2 focus:ring-blue-500 border-2 rounded h-7 l"
                type="number"
                step="1"
                [value]="activeItem ? getActiveItemWidth() : 0"
                (input)="updateWidth($event)"
                min="0"
                [disabled]="!preventCreatingWalls || activeItem == null"
              ></ion-input>
            </div>
            <div class="mt-3">
              <ion-label>Height:</ion-label>
              <ion-input
                aria-label=""
                class="input-field input focus:outline-none focus:ring-2 focus:ring-blue-500 border-2 rounded h-7"
                type="number"
                step="1"
                [value]="activeItem ? getActiveItemHeight() : 0"
                (input)="updateHeight($event)"
                min="0"
                [disabled]="!preventCreatingWalls || activeItem == null"
              ></ion-input>
            </div>
            <div class="mt-3">
              <ion-label>Angle:</ion-label>
              <ion-input
                aria-label=""
                class="input-field input focus:outline-none focus:ring-2 focus:ring-blue-500 border-2 rounded h-7"
                type="number"
                step="1"
                [value]="activeItem ? getActiveItemRotation() : 0"
                (input)="updateRotation($event)"
                min="0"
                [disabled]="!preventCreatingWalls || activeItem == null"
              ></ion-input>
            </div>
          </div>
    
          <div class="mt-2 text-center">
            <hr />
            <div class="flex flex-row justify-evenly mt-4">
              <ion-label>Creating walls</ion-label>
              <ion-toggle
                aria-label="Warning toggle"
                [checked]="!preventCreatingWalls"
                class="col-span-1"
                (ionChange)="toggleEditing()"
              ></ion-toggle>
            </div>
          </div>
    
          <ion-button
            (click)="saveFloorLayout()"
            class="create-event mt-20 ml-20 right-2.5 h-40px text-ept-off-white text-sm/16 rounded-lg bg-green-500 drop-shadow-lg absolute bottom-0 mb-10 hover:scale-102 hover:bg-opacity-100 hover:shadow-[0px_2px_7px_2px_rgba(0,0,0,0.2)]"
            >Save
          </ion-button>
        </div>
        <div ngClass="back-side">
          <div class="flex flex-row justify-evenly">
            <h1 class="text-lg font-semibold text-center mt-5">Link Sensors</h1>
            <ion-button
              id="hover-trigger"
              *ngIf="isSensor()"
              class="mt-4 rounded-lg overflow-hidden self-center bg-ept-deep-grey hover:scale-105 duration-300 transition-all"
              title="Click to view Tools"
              (click)="toggleCardFlip()"
            >
              <ion-icon name="repeat" class="w-8 h-8"></ion-icon>
            </ion-button>
          </div>
          <hr class="mt-3 mb-3">
          <div class="flex flex-col text-center">
            <ion-label class="text-ept-deep-grey opacity-40">Selected Sensor Id:</ion-label>
            <ion-text class="text-ept-deep-grey font-bold m-auto opacity-1">{{getSelectedSensorId()}}</ion-text>
          </div>
          <div class="mt-5 text-center">
            <ion-label class="text-ept-deep-grey opacity-40">Select a sensor to link with:</ion-label>
            <ion-list>
              <ion-item
                *ngFor="let sensorId of SensorIds"
              >
                <ion-checkbox>
                  <ion-label>{{sensorId}}</ion-label>
                </ion-checkbox>
              </ion-item>
            </ion-list>
            <ion-text class="text-red-500 font-bold m-auto opacity-1" *ngIf="SensorIds.length === 0">No sensors found</ion-text>
          </div>
        </div>
      </div>
    </div>
    <div
      id="canvasParent"
      #canvasParent
      class="relative col-span-10 border-4 border-black rounded-lg md:rounded-xl shadow-[0px_5px_15px_2px_rgba(0,0,0,0.2)] text-ept-deep-grey p-2"
      (drop)="onDrop($event)"
      (dragover)="onDragOver($event)"
    >
      <p
        class="bg-white z-50 rounded-md text-center text-2xl text-ept-deep-grey text-opacity-30 font-semibold mt-10 absolute top-1/2 left-1/3"
        *ngIf="noItemsAdded()"
      >
        Drag a component to the canvas
      </p>
      <div
        id="canvasElement"
        #canvasElement
        class="border-ept-off-white border-2 rounded-lg md:rounded-xl w-full h-full"
      ></div>
      <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2">
        <img
          #dustbin
          *ngIf="!noItemsAdded()"
          class="dustbin"
          (dragover)="onDustbinDragOver($event)"
          (dragleave)="onDustbinDragLeave($event)"
          (mouseup)="onDustbinMouseUp($event)"
          [ngClass]="{'drag-over': openDustbin}"
          [src]="openDustbin ? 'assets/trash-open.svg' : 'assets/trash-svgrepo-com.svg'"
          alt="trash"
          class="bg-white h-10 transition-all duration-300"
        />
      </div>
    </div>
  </div>
  <ion-toast
    [isOpen]="preventCreatingWalls"
    message="Wall Creation Disabled"
    [duration]="2000"
    class="text-center"
    color="danger"
  ></ion-toast>
  <ion-toast
    [isOpen]="!preventCreatingWalls"
    message="Wall Creation Enabled"
    [duration]="2000"
    class="text-center"
    color="success"
  ></ion-toast>
</ion-content>
