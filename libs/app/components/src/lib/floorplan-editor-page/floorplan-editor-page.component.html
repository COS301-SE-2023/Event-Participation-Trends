<div class="top-0 left-0 w-full h-screen">
  <div class="grid grid-cols-36 gap-3 p-3 h-full">
    <div
      class="tool-menu col-span-7 max-h-full overflow-y-scroll rounded-lg md:rounded-xl shadow-[0px_5px_15px_2px_rgba(0,0,0,0.2)] text-ept-deep-grey relative flex flex-col justify-between"
      ngClass="card-container"
      [ngClass]="{'bg-white': lightMode, 'bg-ept-navy-blue': !lightMode}"
    >
      <h1 class="text-2xl font-semibold text-center mt-5" [ngClass]="{'text-white': !lightMode, 'text-ept-deep-grey': lightMode}">Tools</h1>                
      <h2
        class="components-heading flex justify-between items-center mt-4 ml-2 text-lg"
        [ngClass]="{'opacity-50 pointer-events-none': !preventCreatingWalls, 'text-white': !lightMode, 'text-ept-deep-grey': lightMode}"
      >
        Components
      </h2>
      <div 
        class="components-list mb-1 overflow-hidden" 
        [ngClass]="{'cursor-not-allowed': !preventCreatingWalls}" 
        [title]="getComponentsTitle()"
      >
        <div
          class="overflow-y-auto max-h-fit flex ml-4"
          [ngClass]="{'disabled opacity-50 pointer-events-none': !preventCreatingWalls}"
        >
          <img
            id="sensorImage"
            class="border-2 rounded-lg w-10 h-10 mt-2 cursor-grab"
            [ngClass]="{'p-1' : lightMode, 'p-0' : !lightMode}"
            draggable="true"
            (dragstart)="onDragStart($event)"
            [src]="lightMode ? 'assets/sensor.png' : 'assets/sensor-white-2.png'" alt="Sensor Image"
            alt="sensor"
          />
          <label class="text-ept-deep-grey opacity-40 mt-4 ml-4" [ngClass]="{'text-white': !lightMode, 'text-ept-deep-grey': lightMode}"
            >Sensor</label
          >
        </div>
        <div
          class="overflow-y-auto max-h-52 flex ml-4"
          [ngClass]="{'disabled opacity-50 pointer-events-none': !preventCreatingWalls}"
        >
          <img
            class="border-2 rounded-lg w-10 h-10 mt-2 cursor-grab"
            [ngClass]="{'p-1' : lightMode, 'p-0' : !lightMode}"
            #stall
            draggable="true"
            (dragstart)="onDragStart($event)"
            [src]="lightMode ? 'assets/stall-icon.png' : 'assets/stall-icon-dark.png'"
            alt="stall"
          />
          <label class="text-ept-deep-grey opacity-40 mt-4 ml-4" [ngClass]="{'text-white': !lightMode, 'text-ept-deep-grey': lightMode}"
            >Stall</label
          >
        </div>
        <div
          class="overflow-y-auto max-h-52 flex ml-4"
          [ngClass]="{'disabled opacity-50 pointer-events-none': !preventCreatingWalls}"
        >
          <img
            id="textBox"
            class="border-2 rounded-lg w-10 h-10 mt-2 cursor-grab"
            [ngClass]="{'p-1' : lightMode, 'p-0 bg-white' : !lightMode}"
            draggable="true"
            (dragstart)="onDragStart($event)"
            src="assets/black-text-selection-svgrepo-com.svg"
            alt="sensor"
          />
          <label class="text-ept-deep-grey opacity-40 mt-4 ml-4" [ngClass]="{'text-white': !lightMode, 'text-ept-deep-grey': lightMode}"
            >Text</label
          >
        </div>
        <hr class="m-3" />
        <div
          class="relative overflow-y-auto max-h-52 flex ml-4"
          [title]="getWallTitle()"
        >
          <div class="absolute w-full h-full cursor-pointer" (click)="toggleEditing()"></div>
          <img
            id="wall"
            class=" p-1 w-10 h-10 mt-2 cursor-pointer"
            draggable="false"
            [src]="lightMode ? 'assets/wall-creation-icon.svg' : 'assets/white-wall-creation-icon.svg'"
            alt="wall"
            (click)="toggleEditing()"
          />
          <label 
            class="text-ept-deep-grey mt-4 ml-4 cursor-pointer"
            (click)="toggleEditing()"
            [ngClass]="{'text-white': !lightMode, 'text-ept-deep-grey': lightMode}"
          >
            Create walls
            </label
            >
            <input
            type="checkbox"
            class="ml-8 mt-5 cursor-pointer w-4 h-4"
            (click)="toggleEditing()"
            [checked]="!preventCreatingWalls"
            />
          </div>
        </div>
        <label 
          *ngIf="!preventCreatingWalls"
          class="text-ept-deep-grey opacity-40 mt-1 ml-4 cursor-pointer text-xs pointer-events-none"
          title="Click and drag on canvas to create walls"
        >
          Click and drag on canvas to create walls
        </label>
      <hr *ngIf="showLengthInput() || showAngleInput() || showTextInput()" class="m-3" />
      <h2 
        *ngIf="showLengthInput() || showAngleInput() || showTextInput()" 
        class="attributes-heading mt-3 ml-2 text-lg"
        [ngClass]="{'text-white': !lightMode, 'text-ept-deep-grey': lightMode}"
      >
        Component Attributes
      </h2>
      <div
        *ngIf="!shouldStackVertically"
        id="attributes-container"
        class="flex flex-col cursor-default"
      >
        <div *ngIf="showTextInput()" class="mt-2 p-2 flex flex-row items-center justify-evenly" lines="none">
          <label [ngClass]="{'text-white': !lightMode, 'text-ept-deep-grey': lightMode}">Text:</label><br>
          <input
            #textInput
            id="textInput"
            aria-label=""
            class="input focus:outline-none focus:ring-2 focus:ring-blue-500 border-2 rounded h-7 w-[200px] justify-center"
            [ngClass]="{'bg-white border-ept-blue-grey': !lightMode}"
            type="text"
            pattern="[a-zA-Z0-9 ]*"
            [value]="activeItem ? getActiveItemText() : ''"
            (input)="updateText($event)"
            [attr.maxlength]="getMaxTextLength()"
            label="Text:"
            labelPlacement="floating"
          />
        </div>
        <p 
          *ngIf="showTextInput()"
          class="text-ept-deep-grey mr-4 opacity-40 flex flex-row justify-end text-xs"
          [ngClass]="{'opacity-50' : !selectedTextBox, 'text-white' : !lightMode}"
        >
          {{getTextLength()}}/{{getMaxTextLength()}}
        </p>
        <div *ngIf="showLengthInput()" class="attributes-list flex flex-row items-center justify-evenly mt-2 p-2" lines="none">
          <label 
            class="flex mr-3 min-w-fit" 
            [ngClass]="{'opacity-50' : !preventCreatingWalls || activeItem === null || !selectedWall, 'text-white': !lightMode, 'text-ept-deep-grey': lightMode}"
          >
            Length:
          </label>
          <input
            aria-label=""
            class="flex input-field input focus:outline-none focus:ring-2 focus:ring-blue-500 border-2 rounded h-7 w-[100px]"
            type="number"
            step="0.5"
            [value]="(activeItem && selectedWall) ? getActiveItemWidth() : 0"
            (input)="updateWidth($event)"
            [ngClass]="{'opacity-50 pointer-events-none' : !preventCreatingWalls || activeItem === null || !selectedWall, 'bg-white border-ept-blue-grey': !lightMode}"
          />
        </div>
        <div *ngIf="showAngleInput()" class="attributes-list flex flex-row items-center justify-evenly mt-2 p-2" lines="none">
          <label 
            class="flex mr-3 min-w-fit" 
            [ngClass]="{'opacity-50' : !preventCreatingWalls || activeItem === null || selectedSensor, 'text-white': !lightMode, 'text-ept-deep-grey': lightMode}"
          >
            Angle:
          </label>
          <input
            aria-label=""
            class="flex input-field input focus:outline-none focus:ring-2 focus:ring-blue-500 border-2 rounded h-7 w-[100px]"
            type="number"
            step="1"
            [value]="(activeItem && !selectedSensor) ? getActiveItemRotation() : 0"
            (input)="updateRotation($event)"
            [ngClass]="{'opacity-50 pointer-events-none' : !preventCreatingWalls || activeItem === null || !selectedWall, 'bg-white border-ept-blue-grey': !lightMode}"
          />
        </div>
      </div>
      <div
        *ngIf="shouldStackVertically"
        id="attributes-container"
        class="flex flex-col items-center justify-evenly"
      >
        <div *ngIf="showTextInput()" class="mt-3">
          <div class="p-1">
            <label [ngClass]="{'text-white': !lightMode, 'text-ept-deep-grey': lightMode}">Text:</label><br>
            <input
              #textInput
              id="textInput"
              aria-label=""
              class="input focus:outline-none focus:ring-2 focus:ring-blue-500 border-2 rounded h-7 w-[150px]"
              [ngClass]="{'bg-white border-ept-blue-grey': !lightMode}"
              type="text"
              pattern="[a-zA-Z0-9 ]*"
              [value]="activeItem ? getActiveItemText() : ''"
              (input)="updateText($event)"
              [disabled]="!preventCreatingWalls || activeItem === null|| !selectedTextBox"
              maxlength="15"
              label="Text:"
              labelPlacement="floating"
            />
            <p 
              class="text-ept-deep-grey opacity-40 mr-4 flex flex-row justify-end text-xs"
              [ngClass]="{'opacity-50' : !selectedTextBox, 'text-white' : !lightMode}"
            >
              {{getTextLength()}}/{{getMaxTextLength()}}
            </p>
          </div>
        </div>
        <div *ngIf="showLengthInput()" class="mt-3">
          <label 
            [ngClass]="{'opacity-50' : !preventCreatingWalls || activeItem === null || !selectedWall, 'text-white': !lightMode, 'text-ept-deep-grey': lightMode}"
          >
            Length:
          </label><br/>
          <input
            aria-label=""
            class="input-field input focus:outline-none focus:ring-2 focus:ring-blue-500 border-2 rounded h-7 w-[100px]"
            type="number"
            step="0.5"
            [value]="(activeItem && selectedWall) ? getActiveItemWidth() : 0"
            (input)="updateWidth($event)"
            [disabled]="!preventCreatingWalls || activeItem === null || !selectedWall"
            [ngClass]="{'opacity-50' : !preventCreatingWalls || activeItem === null || selectedSensor || !selectedWall, 'bg-white border-ept-blue-grey': !lightMode}"
          >
        </div>
        <div *ngIf="showAngleInput()" class="mt-3">
          <label 
            [ngClass]="{'opacity-50' : !preventCreatingWalls || activeItem === null || selectedSensor, 'text-white': !lightMode}"
          >
            Angle:
          </label><br/>
          <input
            aria-label=""
            class="input-field input focus:outline-none focus:ring-2 focus:ring-blue-500 border-2 rounded h-7 mt-3 w-[100px]"
            type="number"
            step="1"
            [value]="(activeItem && !selectedSensor) ? getActiveItemRotation() : 0"
            (input)="updateRotation($event)"
            [disabled]="!preventCreatingWalls || activeItem === null || selectedSensor"
            [ngClass]="{'opacity-50' : !preventCreatingWalls || activeItem === null || selectedSensor, 'bg-white border-ept-blue-grey': !lightMode}"
          >
        </div>
      </div>
      <hr [ngClass]="{'hidden' : !showSensorLinking()}" class="m-3" />
      <div [ngClass]="{'hidden' : !showSensorLinking()}">
        <h1 
          class="text-lg font-semibold text-center mb-3"
          [ngClass]="{'text-white': !lightMode, 'text-ept-deep-grey': lightMode}"
        >
          Link Sensor
        </h1>
        <div class="flex flex-col items-start ml-3">
          <div class="flex items-center w-full">
            <input 
              type="radio" 
              name="linkOption" 
              id="altOption" 
              [checked]="hideScanner" 
              (change)="hideQRCodeScanner()" 
              [ngClass]="{'bg-ept-bumble-yellow': hideScanner}"
            />
            <label for="altOption" class="cursor-pointer sm:text-sm md:text-md" [ngClass]="{'text-white': !lightMode}">
              Link with manual input
            </label>
          </div>
          <div class="flex items-center w-full">
            <input type="radio" name="linkOption" id="qrOption" [checked]="!hideScanner" (change)="showQRCodeScanner()" [ngClass]="{'bg-ept-bumble-yellow': !hideScanner}"/>
            <label for="qrOption" class="cursor-pointer sm:text-sm md:text-md" [ngClass]="{'text-white': !lightMode}">
              QR Code Scanner
            </label>
          </div>
        </div>
        <div #reader id="reader" class="m-2 w-[180px] rounded" [ngClass]="{'hidden': hideScanner, 'bg-ept-off-white' : !lightMode}"></div>
        <form [formGroup]="macAddressForm" [ngClass]="{'hidden': !hideScanner}">
          <div class="mt-4 flex flex-col items-center justify-evenly">
            <div class="flex items-center">
              <input
                id="macAddressBlock1"
                aria-label="MAC Address Block"
                class="bg-slate-200 lg:w-7 md:w-5 uppercase border-2 rounded-md text-center"
                type="text"
                maxlength="2"
                (input)="handleMacAddressInput($event, 0)"
                (focus)="setInputFocus(true)"
                (blur)="setInputFocus(false)"
                name="macAddressBlock1"
                formControlName="macAddressBlock1"
                [ngClass]="{ 'border-2 border-rose-500': macAddressBlock1?.hasError('required') && (macAddressBlock1?.dirty || macAddressBlock1?.touched), 'border-2 border-green-400' : macAddressBlock1?.valid && (macAddressBlock1?.dirty || macAddressBlock1?.touched)}"
                />
                <span class="ml-1 mr-1">:</span>
                <input
                id="macAddressBlock2"
                aria-label="MAC Address Block"
                class="bg-slate-200 lg:w-7 md:w-5 uppercase border-2 rounded-md text-center"
                type="text"
                maxlength="2"
                (input)="handleMacAddressInput($event, 1)"
                (focus)="setInputFocus(true)"
                (blur)="setInputFocus(false)"
                name="macAddressBlock2"
                formControlName="macAddressBlock2"
                [ngClass]="{ 'border-2 border-rose-500': macAddressBlock2?.hasError('required') && (macAddressBlock2?.dirty || macAddressBlock2?.touched), 'border-2 border-green-400' : macAddressBlock2?.valid && (macAddressBlock2?.dirty || macAddressBlock2?.touched)}"
              />
              <span class="ml-1 mr-1">:</span>
              <input
                id="macAddressBlock3"
                aria-label="MAC Address Block"
                class="bg-slate-200 lg:w-7 md:w-5 uppercase border-2 rounded-md text-center"
                type="text"
                maxlength="2"
                (input)="handleMacAddressInput($event, 2)"
                (focus)="setInputFocus(true)"
                (blur)="setInputFocus(false)"
                name="macAddressBlock3"
                formControlName="macAddressBlock3"
                [ngClass]="{ 'border-2 border-rose-500': macAddressBlock3?.hasError('required') && (macAddressBlock3?.dirty || macAddressBlock3?.touched), 'border-2 border-green-400' : macAddressBlock3?.valid && (macAddressBlock3?.dirty || macAddressBlock3?.touched)}"
              />
              <span class="ml-1 mr-1">:</span>
              <input
                id="macAddressBlock4"
                aria-label="MAC Address Block"
                class="bg-slate-200 lg:w-7 md:w-5 uppercase border-2 rounded-md text-center"
                type="text"
                maxlength="2"
                (input)="handleMacAddressInput($event, 3)"
                (focus)="setInputFocus(true)"
                (blur)="setInputFocus(false)"
                name="macAddressBlock4"
                formControlName="macAddressBlock4"
                [ngClass]="{ 'border-2 border-rose-500': macAddressBlock4?.hasError('required') && (macAddressBlock4?.dirty || macAddressBlock4?.touched), 'border-2 border-green-400' : macAddressBlock4?.valid && (macAddressBlock4?.dirty || macAddressBlock4?.touched)}"
              />
              <span class="ml-1 mr-1">:</span>
              <input
                id="macAddressBlock5"
                aria-label="MAC Address Block"
                class="bg-slate-200 lg:w-7 md:w-5 uppercase border-2 rounded-md text-center"
                type="text"
                maxlength="2"
                (input)="handleMacAddressInput($event, 4)"
                (focus)="setInputFocus(true)"
                (blur)="setInputFocus(false)"
                name="macAddressBlock5"
                formControlName="macAddressBlock5"
                [ngClass]="{ 'border-2 border-rose-500': macAddressBlock5?.hasError('required') && (macAddressBlock5?.dirty || macAddressBlock5?.touched), 'border-2 border-green-400' : macAddressBlock5?.valid && (macAddressBlock5?.dirty || macAddressBlock5?.touched)}"
              />
              <span class="ml-1 mr-1">:</span>
              <input
                id="macAddressBlock6"
                aria-label="MAC Address Block"
                class="bg-slate-200 lg:w-7 md:w-5 uppercase border-2 rounded-md text-center"
                type="text"
                maxlength="2"
                (input)="handleMacAddressInput($event, 5)"
                (focus)="setInputFocus(true)"
                (blur)="setInputFocus(false)"
                name="macAddressBlock6"
                formControlName="macAddressBlock6"
                [ngClass]="{ 'border-2 border-rose-500': macAddressBlock6?.hasError('required') && (macAddressBlock6?.dirty || macAddressBlock6?.touched), 'border-2 border-green-400' : macAddressBlock6?.valid && (macAddressBlock6?.dirty || macAddressBlock6?.touched)}"
              />
            </div>
            <button
              class="mt-3  rounded-md p-1 text-sm/16 cursor-pointer"
              [ngClass]="{'opacity-50 pointer-events-none': !canLinkSensorWithMacAddress, 'bg-ept-blue-grey text-ept-deep-grey': !lightMode, 'bg-ept-deep-grey text-ept-off-white': lightMode}"
              (click)="updateLinkedSensors()"
              >Link Sensor</button
            >
          </div>
        </form>
        <!-- <div *ngIf="activeSensor$ | async as sensor" class="mt-3 flex flex-row justify-evenly"> -->
          <!-- <p class="text-ept-deep-grey">Sensor Status:</p> -->
          <!-- <ion-badge
          color="{{ sensor['isLinked'] ? 'success' : 'danger' }}"
          class="text-ept-off-white"
          >{{ sensor['isLinked'] ? 'Linked' : 'Not Linked' }}</ion-badge> -->
        <!-- </div> -->
      </div>
      <div class="mt-auto mb-5 flex justify-center">
        <button
          (click)="saveFloorLayout()"
          class="create-event h-40px w-[100px] text-ept-off-white text-sm/16 rounded-lg bg-green-500 drop-shadow-lg hover:scale-102 hover:bg-opacity-100 hover:shadow-[0px_2px_7px_2px_rgba(0,0,0,0.2)]"
          >Save
        </button>
      </div>
    </div>
    <div
        id="canvasParent"
        #canvasParent
        class="relative col-span-29 bg-white rounded-lg md:rounded-xl shadow-[0px_5px_15px_2px_rgba(0,0,0,0.2)] text-ept-deep-grey p-2"
        (drop)="onDrop($event)"
        (dragover)="onDragOver($event)"
        >
        <p
            class="bg-white z-50 rounded-md text-center text-2xl text-ept-deep-grey text-opacity-30 font-semibold mt-10 absolute top-1/2 left-1/3"
            *ngIf="canvasItems.length === 0 && preventCreatingWalls"
        >
            Drag a component to the canvas
        </p>
        <p
            class="bg-white z-50 rounded-md text-center text-2xl text-ept-deep-grey text-opacity-30 font-semibold mt-10 absolute top-1/2 left-1/3"
            *ngIf="canvasItems.length === 0 && !preventCreatingWalls"
        >
            Click and drag to create walls
        </p>
        <div
            id="canvasElement"
            #canvasElement
            class="border-ept-off-white border-2 rounded-lg md:rounded-xl w-full h-full"
        ></div>
        <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2">
            <img
            #dustbin
            *ngIf="canvasItems.length > 0"
            class="dustbin"
            (dragover)="onDustbinDragOver($event)"
            (dragleave)="onDustbinDragLeave($event)"
            (mouseup)="onDustbinMouseUp($event)"
            [ngClass]="{'drag-over': openDustbin}"
            [src]="chooseDustbinImage()"
            alt="trash"
            class="bg-white h-10 transition-all duration-300"
            />
        </div>
        <div class="absolute bottom-2.5 right-2.5 bg-ept-off-white border-2 border-ept-deep-grey rounded">
            <label id="scaleLabel" class="text-ept-deep-grey p-0.5 rounded">1 Block = {{gridSizeLabel}}m</label>
            <br/>
            <label id="scaleLabel" class="text-ept-deep-grey p-0.5 rounded">1 Snap = {{snapLabel}}m</label>
        </div>
        <div class="absolute bottom-2.5 left-2.5 flex flex-row bg-ept-off-white">
            <div 
              (click)="zoomIn()" 
              class="h-8 mr-1 text-3xl border-ept-blue-grey border-2 border-solid rounded hover:cursor-pointer hover:opacity-100 hover:text-ept-deep-grey hover:bg-ept-blue-grey z-50"
              [ngClass]="{'opacity-20 pointer-events-none border-opacity-50': zoomInDisabled}">
              <ng-icon name="matZoomIn" title="Zoom in"></ng-icon>
            </div>
            <div 
              (click)="zoomOut()" 
              class="h-8 mr-1 text-3xl border-ept-blue-grey border-2 border-solid rounded hover:cursor-pointer hover:opacity-100 hover:text-ept-deep-grey hover:bg-ept-blue-grey z-50"
              [ngClass]="{'opacity-20 pointer-events-none border-opacity-50': zoomOutDisabled}"
            >
              <ng-icon name="matZoomOut" title="Zoom out"></ng-icon>
            </div>
            <div 
              class="h-8 text-3xl border-ept-blue-grey border-2 border-solid rounded hover:cursor-pointer hover:opacity-100 hover:text-ept-deep-grey hover:bg-ept-blue-grey z-50"
              [ngClass]="{'opacity-20 pointer-events-none border-opacity-50': centerDisabled}"
            >
              <ng-icon name="matFilterCenterFocus" title="Recenter floorplan" (click)="centerFloorPlan()"></ng-icon>
            </div>
        </div>
    </div>
  </div>
</div>
