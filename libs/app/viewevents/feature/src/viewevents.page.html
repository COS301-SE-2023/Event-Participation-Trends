<div
  class="bg-[url('assets/blob-scene-haikei-dark.svg')] fixed opacity-75 top-0 left-0 w-screen h-screen z-0"
></div>
<div
  class="bg-cover bg-no-repeat bg-center bg-fixed h-full overflow-y-scroll z-10"
>
  <ion-toast
    [isOpen]="didRefresh && newEventsFound"
    message="There are new events available!"
    [duration]="2000"
    class="text-center"
    color="warning"
    position="top"
  ></ion-toast>
  <ion-toast
    [isOpen]="didRefresh && !newEventsFound"
    message="No new events."
    [duration]="2000"
    class="text-center"
    color="warning"
    position="top"
  ></ion-toast>
  <div
    class="min-h-full h-fit"
    [ngClass]="{'items-center flex justify-center': isLoading}"
  >
    <div *ngIf="isLoading" class="flex flex-col justify-center items-center">
      <ion-spinner
        name="bubbles"
        class="text-ept-bumble-yellow w-24 h-24"
      ></ion-spinner>
      <ion-label>Loading Content...</ion-label>
    </div>
    <div *ngIf="!isLoading" class="grid grid-cols-3 px-6 mx-7">
      <!-- <div class="col-span-1 flex items-center">
        <ion-refresher slot="fixed" [pullMin]="30" [pullMax]="70" (ionRefresh)="handleRefresh($event)">
          <ion-refresher-content 
            pullingIcon="arrow-down-circle-outline"
            refreshingSpinner="bubbles"
            class="absolute left-4 text-ept-bumble-yellow"
          ></ion-refresher-content>
        </ion-refresher>
      </div> -->
      <div
        class="col-span-4 mt-5 1032:mt-0 md:col-span-1 flex items-center justify-self-center md:justify-self-start"
      >
        <p class="text-3xl text-white">Events</p>
      </div>
      <span
        ngClass="sidebar-content"
        class="flex w-full col-span-3 lg:col-span-1 py-6"
      >
        <ion-searchbar
          ngClass="sidebar-searchbar"
          placeholder="Search"
          [(ngModel)]="searchValue"
        ></ion-searchbar>
      </span>
    </div>
    <div class="grid grid-cols-3 p-6 px-7" *ngIf="myEventsTitle()">
      <div class="col-span-1 flex items-center" *ngIf="myEventsTitle()">
        <p class="text-2xl">My Events</p>
      </div>
    </div>
    <div
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:gird-cols-5 col-auto duration-300 transition-all"
      *ngIf="managerUp()"
    >
      <ion-card
        *ngFor="let event of managedEvents()"
        class="h-56 m-8 rounded-lg md:rounded-xl backdrop-blur-[4px] bg-white bg-opacity-[85%] shadow-[0px_5px_15px_2px_rgba(0,0,0,0.2)] text-ept-deep-grey duration-300 transition-all hover:scale-105 hover:cursor-pointer hover:bg-opacity-100 hover:shadow-[0px_5px_15px_5px_rgba(0,0,0,0.2)]"
        (click)="openEvent(event)"
      >
        <ion-card-content
          class="flex flex-col h-full duration-300 transition-all bg-transparent"
          title="This event has no floor layout"
        >
          <ion-icon
            *ngIf="!hasFloorLayout(event)"
            class="h-8 w-8 p-4 duration-300 transition-all absolute self-end text-ept-bumble-yellow"
            name="Warning"
          >
          </ion-icon>
          <p
            class="p-4 text-xl md:text-2xl self-start duration-300 transition-all font-medium bg-transparent"
            [innerHTML]="highlightText(event.Name, searchValue)"
          ></p>
          <div
            class="flex flex-col items-start text-left justify-end h-full duration-300 transition-all bg-transparent"
          >
            <p class="px-4 py-2 self-start duration-300 transition-all">
              Location: {{getLocation(event)}}
            </p>
            <p class="px-4 py-2 self-start duration-300 transition-all">
              Category: {{event.Category}}
            </p>
          </div>
        </ion-card-content>
      </ion-card>
      <ion-card
        class="h-56 m-8 rounded-lg md:rounded-xl shadow-[0px_5px_15px_2px_rgba(0,0,0,0.2)] duration-300 transition-all hover:scale-105 hover:cursor-pointer bg-ept-deep-grey bg-opacity-[40%] text-ept-off-white hover:bg-opacity-60"
      >
        <ion-card-content
          class="flex items-center justify-center h-full duration-300 transition-all"
          (click)="openAddEventPage()"
        >
          <ion-icon
            class="h-16 w-16 duration-300 transition-all"
            name="add-outline"
          ></ion-icon>
        </ion-card-content>
      </ion-card>
    </div>
    <div class="grid grid-cols-3 p-6 px-7" *ngIf="allEventsLength">
      <div class="col-span-1 flex items-center">
        <p class="text-2xl">All Events</p>
      </div>
    </div>
    <div
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:gird-cols-5 col-auto duration-300 transition-all"
    >
      <ion-card
        *ngFor="let event of subscribedEvents()"
        class="h-56 m-8 rounded-lg md:rounded-xl shadow-[0px_5px_15px_2px_rgba(0,0,0,0.2)] text-ept-deep-grey duration-300 transition-all hover:cursor-pointer"
        [ngClass]="{'bg-white bg-opacity-[85%] hover:scale-105 hover:bg-opacity-100 hover:shadow-[0px_5px_15px_5px_rgba(0,0,0,0.2)]' : hasAccess(event), 'bg-ept-deep-grey bg-opacity-[40%] text-ept-off-white hover:bg-opacity-60' : !hasAccess(event)}"
        (click)="openEvent(event)"
      >
        <ion-card-content
          class="flex flex-col h-full duration-300 transition-all"
        >
          <ion-icon
            *ngIf="!hasAccess(event)"
            class="h-6 w-6 p-4 duration-300 transition-all absolute self-end text-ept-off-white font-lg"
            name="lock-closed-outline"
          >
          </ion-icon>
          <p
            class="p-4 text-xl md:text-2xl self-start duration-300 transition-all font-medium"
            [innerHTML]="highlightText(event.Name, searchValue)"
          ></p>
          <div
            class="flex flex-col items-start text-left justify-end h-full duration-300 transition-all"
          >
            <p class="px-4 py-2 self-start duration-300 transition-all">
              Location: {{getLocation(event)}}
            </p>
            <p class="px-4 py-2 self-start duration-300 transition-all">
              Category: {{event.Category}}
            </p>
          </div>
        </ion-card-content>
      </ion-card>
      <ion-card
        *ngFor="let event of unsubscribedEvents()"
        class="h-56 m-8 rounded-lg md:rounded-xl shadow-[0px_5px_15px_2px_rgba(0,0,0,0.2)] text-ept-deep-grey duration-300 transition-all hover:cursor-pointer"
        [ngClass]="{'bg-white bg-opacity-[85%] hover:scale-105 hover:bg-opacity-100 hover:shadow-[0px_5px_15px_5px_rgba(0,0,0,0.2)]' : hasAccess(event), 'bg-ept-deep-grey bg-opacity-[40%] text-ept-off-white hover:bg-opacity-60' : !hasAccess(event)}"
        (click)="showRequestAccessMenu(event)"
      >
        <ion-card-content
          class="flex flex-col h-full duration-300 transition-all"
        >
          <ion-icon
            *ngIf="!hasAccess(event)"
            class="h-6 w-6 p-4 duration-300 transition-all absolute self-end text-ept-off-white font-lg"
            name="lock-closed-outline"
          >
          </ion-icon>
          <p
            class="p-4 text-xl md:text-2xl self-start duration-300 transition-all font-medium"
            [innerHTML]="highlightText(event.Name, searchValue)"
          ></p>
          <div
            class="flex flex-col items-start text-left justify-end h-full duration-300 transition-all"
          >
            <p class="px-4 py-2 self-start duration-300 transition-all">
              Location: {{getLocation(event)}}
            </p>
            <p class="px-4 py-2 self-start duration-300 transition-all">
              Category: {{event.Category}}
            </p>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</div>
